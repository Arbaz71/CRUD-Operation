<mat-card class="header-main-content">
    <div fxLayout="row">
        <div fxFlex="25%" class="breadcrumb-content">
        </div>
        <div fxFlex="50%" class="breadcrumb-header-content">
            Product Variants
        </div>
        <div fxFlex="25%" class="breadcrumb-btn-content">
            <button class="add-new-btn" [routerLink]="['/products/create']" type="button">
                <a class="add-new-label">
                    <img src="assets/icon/plus-math.svg" alt="Add New" class="plus-math">
                    ADD NEW
                </a>
            </button>
        </div>
    </div>
</mat-card>
<mat-progress-bar mode="indeterminate" *ngIf="inProgress"></mat-progress-bar>
<div style="padding-top: 20px">
    <div fxFlex="96%" fxFlexOffset="2%">
        <div class="" fxLayout="row" fxLayoutWrap fxLayoutAlign="center">
            <div class="search-input" fxFlex="90%" fxFlex.md="80%" fxFlex.lg="80%" fxFlex.sm="65%" fxFlex.xs="65%">
                <img class="Search-icon" alt="Search" src="../../assets/icon/search.png">
                <!-- <input class="Search" (keyup)="ApplyFilter($event.target.value)" placeholder="Search..." [formControl]="search"> -->
                <input class="Search" placeholder="Search..." [formControl]="search">
                <!-- <span class="result-count">{{newrows.length}} Results</span> -->
                <span class="result-count">{{total_count}} Results</span>
            </div>
            <div class="search-button pointer" (click)="openFilter(filter_data)" fxFlex="10%" fxFlex.md="20%"
                fxFlex.lg="20%" fxFlex.sm="35%" fxFlex.xs="35%">
                <div fxFlex="70%" class="text"> Filter by
                </div>
                <div fxFlex="30%" class="icon">
                    <mat-icon>keyboard_arrow_down</mat-icon>
                </div>
            </div>
        </div>
        <div fxLayout="column" class="main-container" *ngIf="newrows.length > 0 && !isLoading">
            <mat-card class="list-bulk-action-header">
                <div _ngcontent-c41="" class="button-row add-tag-button">
                    <span matTooltip="Select one or more products to add Tags."
                        [matTooltipDisabled]="selected.length>0">
                        <button mat-button mat-stroked-button type="button" [disabled]="selected.length<1"
                            (click)="AddNewTag('ALL')">ADD TAGS</button>
                    </span>
                </div>
            </mat-card>
            <div class="list-detail-content">
                <!-- <ngx-datatable #myTable class='material expandable fancyscroll employee-list-table'
                    [ngStyle]="{'height':dynamicHeight}" [headerHeight]="50" [externalPaging]="false" [footerHeight]="0"
                    [columnMode]="'flex'" [rowHeight]="48" [scrollbarV]="true" [rows]='rows' [limit]="10"
                    [selected]="selected" [selectionType]="'checkbox'" (activate)="onActivate($event)"
                    (select)='onSelect($event)' [loadingIndicator]="isLoading" (scroll)="onScroll($event.offsetY)"> -->
                <ngx-datatable #myTable class='material server-scrolling-demo' [ngStyle]="{'height':dynamicHeight}"
                    [headerHeight]="headerHeight" [externalPaging]="false" [footerHeight]="0" [columnMode]="'flex'"
                    [rowHeight]="rowHeight" [scrollbarV]="true" [rows]='newrows' [limit]="10" [selected]="selected"
                    [selectionType]="'checkbox'" (activate)="onActivate($event)" (select)='onSelect($event)'
                    (scroll)="onScroll($event.offsetY)">
                    <ngx-datatable-row-detail [rowHeight]="130" #myDetailRow>
                        <ng-template let-row="row" let-expanded="expanded" ngx-datatable-row-detail-template>
                            <div class="example-element-detail" fxLayout="row">
                                <div class="detail-left-block" style="padding-bottom: 10px;" fxFlex="40">
                                    <div class="lable" *ngIf="row['last_purchase_price']">LAST PURCHASE PRICE</div>
                                    <div class="data">{{row['last_purchase_price']|currency}}</div>
                                    <br *ngIf="row['last_purchase_price']">
                                    <div class="lable">BARCODE</div>
                                    <div class="data barcode_text" *ngIf="row['barcodes']">#{{row['barcodes']}}</div>
                                    <!-- <div class="data barcode_text" *ngFor="let barcode of row['barcodes']">#{{barcode.barcode}}</div> -->
                                </div>
                                <div class="list-tag-block fancyscroll" fxFlex="60">
                                    <div fxLayout="row wrap">
                                        <div class="tag-div" *ngFor="let item of row['tags']">
                                            <div class="tag-text">{{item.tag_name}}</div>
                                        </div>
                                    </div>
                                    <mat-chip-list>
                                        <button type="button" class="ADD-TAG pointer" color="primary"
                                            (click)="AddNewTag(row)">
                                            <img src="assets/icon/plus-math.svg" alt="Add New"
                                                class="plus-math add-tag-icon">
                                            ADD TAG
                                        </button>
                                    </mat-chip-list>
                                </div>
                            </div>
                        </ng-template>
                    </ngx-datatable-row-detail>
                    <ngx-datatable-column name="" [sortable]="false" [draggable]="false" [resizeable]="false"
                        [flexGrow]="1" [maxWidth]="60" [minWidth]="50">
                        <ng-template ngx-datatable-header-template let-allRowsSelected="allRowsSelected"
                            let-selectFn="selectFn">
                            <mat-checkbox color="primary" class="all-select-checkbox"
                                (change)="selectFn(!allRowsSelected)" [checked]="allRowsSelected"
                                [indeterminate]="!allRowsSelected && selected.length>0">
                            </mat-checkbox>
                        </ng-template>
                        <ng-template ngx-datatable-cell-template ngx-datatable-cell-template let-row="row"
                            let-expanded="expanded" let-value="value" let-isSelected="isSelected"
                            let-onCheckboxChangeFn="onCheckboxChangeFn">
                            <div class="checkbox-column">
                                <a href="javascript:void(0)" [class.datatable-icon-right]="!expanded"
                                    [class.datatable-icon-down]="expanded" title="Expand/Collapse Row"
                                    class="ngx-expand-arrow"></a>
                                <mat-checkbox color="primary" (click)="$event.stopPropagation();"
                                    (change)="onCheckboxChangeFn($event);" [checked]="isSelected">
                                </mat-checkbox>
                            </div>
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="BRAND NAME" width="100" prop="brand" [resizeable]="false"
                        [flexGrow]="2">
                        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                            <div title='{{row["brand"]}}'>{{(row["brand"] == null || row["brand"] ==
                                'null')?'':
                                row["brand"]}}</div>
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="PRODUCT NAME" width="200" prop="product_name" [resizeable]="false"
                        [flexGrow]="2">
                        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                            <div title='{{row["product_name"]}}'>{{(row["product_name"] == null || row["product_name"] ==
                                'null')?'':
                                row["product_name"]}}</div>
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="VARIANT NAME" width="200" prop="variant_name" [resizeable]="false"
                        [flexGrow]="2">
                        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                            <div title='{{row["variant_name"]}}'>{{(row["variant_name"] == null || row["variant_name"] ==
                            'null')?'':
                            row["variant_name"]}}</div>
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="SKU" prop="variant_sku" width="300" [resizeable]="false" [flexGrow]="2">
                        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                            <div title="{{value}}">{{row["variant_sku"]}}</div>
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="CATEGORY" prop="product_type_name" width="200" [resizeable]="false"
                        [flexGrow]="2">
                        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                            <div title="{{value}}">{{row["product_type_name"]}}</div>
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="SUB-CATEGORY" prop="product_category_name" width="200"
                        [resizeable]="false" [flexGrow]="2">
                        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                            <div title="{{value}}">{{row["product_category_name"]}}</div>
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="STOCK" prop="total_stock" width="100" [resizeable]="false"
                        [flexGrow]="2">
                        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                            <span *ngIf="row['total_stock']==null">0.00</span><span
                                *ngIf="row['total_stock']!=null">{{row["total_stock"]|
                                number:'1.0'}}</span>
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="PRICE" prop="variant_price" width="100" [resizeable]="false"
                        [flexGrow]="2">
                        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                            <span *ngIf="row['variant_price']==null">{{0.00|currency}}</span><span
                                *ngIf="row['variant_price']!=null">{{row["variant_price"]|currency}}
                            </span>
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Status" width="80" [sortable]="false" [resizeable]="false"
                        [flexGrow]="2">
                        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                            <mat-slide-toggle color="primary" [checked]="row['variant_status']==1"
                                (click)="$event.stopPropagation();"
                                (change)="productStatusChange(row['variant_id'],$event)">
                            </mat-slide-toggle>
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="VIEW" [sortable]="false" width="70" [resizeable]="false" [flexGrow]="1">
                        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                            <button mat-icon-button [routerLink]="['/products', row['product_id'], 'view']">
                                <mat-icon>visibility</mat-icon>
                            </button>
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="PRINT" [sortable]="false" width="70" [resizeable]="false"
                        [flexGrow]="1">
                        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                            <button mat-icon-button (click)="printBarcode(row.variant_id)" *ngIf="row['barcodes']">
                                <mat-icon>print</mat-icon>
                            </button>
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-footer>
                        <ng-template ngx-datatable-footer-template></ng-template>
                    </ngx-datatable-footer>
                </ngx-datatable>
            </div>
        </div>
        <div fxLayout="column" *ngIf="newrows.length==0 && !isLoading" style="margin-top: 60px;">
            <div class="center">
                <div>
                    <img alt="No result found" src="../../assets/images/sad.svg" class="sad">
                </div>
                <div>
                    <span class="Sorry-no-results-fo">Sorry, no results found</span>
                </div>
                <div *ngIf="(!Users ||Users.length > 0) && !isLoading">
                    <span class="Please-try-a-differe">Please try a different keyword</span>
                </div>
            </div>
        </div>
    </div>
    <div class="row-selecetd-count" *ngIf="selected.length>0">
        <span>{{selected.length}} Rows Selected</span>
    </div>
</div>