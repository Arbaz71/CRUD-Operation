<mat-card class="header-main-content">
    <div fxLayout="row">
        <div fxFlex="25%" fxFlex.md="35%" fxFlex.sm="40%" class="breadcrumb-content">
        </div>
        <div fxFlex="50%" fxFlex.md="30%" fxFlex.sm="20%" class="breadcrumb-header-content center">
            Waste Report
        </div>
        <div fxFlex="25%" fxFlex.md="35%" fxFlex.sm="40%" class="breadcrumb-btn-content end">
            <button mat-button matSuffix mat-stroked-button class="add-new-btn" [matMenuTriggerFor]="menu" type="button">
                <mat-icon class="report-header-button">get_app</mat-icon>
                <span>
                    <a class="add-new-label">EXPORT</a>
                </span>
            </button>
            <mat-menu #menu="matMenu">
                <button mat-menu-item [disabled]="rows.length == 0" (click)="getExportPDF()">PDF</button>
                <button mat-menu-item [disabled]="rows.length == 0" (click)="getExportCSV('csv')">CSV</button>
                <button mat-menu-item [disabled]="rows.length == 0" (click)="getExportCSV('xls')">EXCEL</button>
            </mat-menu>
            <button mat-button matSuffix mat-stroked-button class="add-new-btn" (click)="reset_form()">
                <mat-icon class="report-header-button">refresh</mat-icon>
                <span>
                    <a class="add-new-label">RESET</a>
                </span>
            </button>
        </div>
    </div>
</mat-card>

<mat-progress-bar mode="indeterminate" *ngIf="inProgress"></mat-progress-bar>
<div class="top-20 report-inner-height">
    <div  fxFlex="96%" fxFlexOffset="2%">
        <mat-card class="box-shadow report-filter-bar">
            <div _ngcontent-c41="" class="button-row">
                <form [formGroup]="waste">
                    <div class="" fxLayout="row" fxLayoutGap="1%" fxLayoutAlign="left">
                        <div fxFlex="30%">
                            <mat-form-field fxFlex="100%">
                                <mat-select [formControl]="waste.controls['waste_type']" placeholder="Type" [disableOptionCentering]="true">
                                    <mat-option value="ALL" selected>ALL</mat-option>
                                    <mat-option value="ORDER">ORDER</mat-option>
                                    <mat-option value="PRODUCT">PRODUCT</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div fxFlex="30%">
                            <mat-form-field fxFlex="100%">
                                <mat-select [formControl]="waste.controls['storage_id']" placeholder="Warehouse" [disableOptionCentering]="true">
                                    <mat-option *ngFor="let wh of warehouse" [value]="wh.storage_id">{{ wh.name }}</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div fxFlex="30%">
                            <mat-form-field fxFlex="100%" class="range-date-input">
                                <input type="text" autocomplete="off" readonly="true" matInput [locale]="localconfi"
                                    [alwaysShowCalendars]="true" ngxDaterangepickerMd [(ngModel)]="selected" [isInvalidDate]="isInvalidDate" startKey="start" endKey="end"
                                    [ranges]="ranges" [formControl]="waste.controls['selected']" [minDate]="minDate"
                                    [maxDate]="maxDate"  placeholder="Select Dates" [autoApply]="true"
                                    [opens]="'left'">
                            </mat-form-field>
                        </div>
                    </div>
                </form>
            </div>
        </mat-card>

        <mat-card class="box-shadow report-listing" *ngIf="rows.length > 0">
            <ngx-datatable #myDatatable class="material fancyscroll waste-table" [ngStyle]="{'height':dynamicHeight}" [headerHeight]="50" [limit]="10"
                [columnMode]="'force'" [footerHeight]="50" [rowHeight]="55" [scrollbarV]="true" [rows]="rows">
                <ngx-datatable-column [resizeable]="false" prop="order_id" name="Order ID">
                    <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                        <span title="{{value}}"> {{value}}</span>
                    </ng-template>
                </ngx-datatable-column>

                <ngx-datatable-column [resizeable]="false" prop="variant_name" name="Variant Name">
                    <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                        <span title="{{value}}"> {{value}}</span>
                    </ng-template>
                </ngx-datatable-column>

                <ngx-datatable-column [resizeable]="false" prop="missing_value" name="Waste Qty">
                    <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                        <span title="{{value}}"> {{value}}</span>
                    </ng-template>
                </ngx-datatable-column>

                <ngx-datatable-column [resizeable]="false" [sortable]="false" prop="stock_price" name="Stock Price">
                    <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                        <span title="{{value}}"> {{value}}</span>
                    </ng-template>
                </ngx-datatable-column>

                <ngx-datatable-column [resizeable]="false" prop="disposal_status" name="Disposal Status">
                    <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                        <span title="{{value}}"> {{value}}</span>
                    </ng-template>
                </ngx-datatable-column>

                <ngx-datatable-column [resizeable]="false" prop="remark" name="Remark">
                    <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                        <span title="{{value}}" matTooltip="{{value}}" matTooltipClass="tooltip-text"> {{value | slice:0:20}}{{value.length < 20 ? '' : '&hellip;'}}</span>
                    </ng-template>
                </ngx-datatable-column>

                <ngx-datatable-column [resizeable]="false" prop="added_by" name="Wasted By">
                    <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                        <span title="{{value}}"> {{value}}</span>
                    </ng-template>
                </ngx-datatable-column>

                <ngx-datatable-column [resizeable]="false" prop="waste_date" name="Wasted On">
                    <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                        <span title="{{value}}"> {{utils.convertLocalDateToUTCDate(value,false) | date: 'dd/MM/yyyy
                            hh:mm a'}}</span>
                    </ng-template>
                </ngx-datatable-column>

                <ngx-datatable-footer>
                    <ng-template 
                        ngx-datatable-footer-template 
                        let-rowCount="rowCount">
                        <div class="total-rows">
                            Total : {{rowCount}}
                        </div>
                    </ng-template>
                </ngx-datatable-footer>
            </ngx-datatable>
        </mat-card>
        <div fxLayout="column" *ngIf="rows.length==0 && !inProgress" class="report-error-msg">
            <div class="center">
                <div>
                    <img src="../../assets/images/sad.svg" class="sad" alt="No Data Found">
                </div>
                <div>
                    <span class="Sorry-no-results-fo">Sorry, no results found</span>
                </div>
            </div>
        </div>
    </div>
</div>