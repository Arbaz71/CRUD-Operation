<mat-card class="header-main-content">
	<div fxLayout="row">
		<div fxFlex="25%" fxFlex.md="40%" fxFlex.sm="40%" fxFlex.lg="30%" class="breadcrumb-content"></div>
		<div fxFlex="50%" fxFlex.md="20%" fxFlex.sm="20%" fxFlex.lg="40%" class="breadcrumb-header-content center">Low Sales Report</div>
		<div fxFlex="25%" fxFlex.md="40%" fxFlex.sm="40%" fxFlex.lg="30%" class="breadcrumb-btn-content end">
			<button mat-button matSuffix mat-stroked-button class="add-new-btn export" [matMenuTriggerFor]="menu" type="button">
          <mat-icon class="report-header-button">get_app</mat-icon>
          <a class="add-new-label">EXPORT</a>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item [disabled]="rows.length == 0" (click)="getExport('pdf')">PDF</button>
          <button mat-menu-item [disabled]="rows.length == 0" (click)="getExport('csv')">CSV</button>
          <button mat-menu-item [disabled]="rows.length == 0" (click)="getExport('xls')">EXCEL</button>
        </mat-menu>
		</div>
	</div>
</mat-card>

<mat-progress-bar mode="indeterminate" *ngIf="inProgress"></mat-progress-bar>
<div class="top-20 report-inner-height">
	<div fxFlex="96%" fxFlexOffset="2%">
		<div fxLayout="column">
			<div class="searchbar-div" fxLayout="row" fxLayoutWrap fxLayoutAlign="center">
				<div class="customsales-search-input" fxFlex="100%" fxFlex.md="100%" fxFlex.lg="100%" fxFlex.sm="100%" fxFlex.xs="100%">
					<img class="Search-icon" src="../../assets/icon/search.png" alt="Search" />
					<input class="Search" (keyup)="applyFilter($event.target.value)" placeholder="Search..." [formControl]="search" />
					<span class="result-count">{{ rows.length }} Results</span>
				</div>
			</div>
		</div>

		<mat-card class="box-shadow report-filter-bar">
			<div _ngcontent-c41="" class="button-row">
				<form [formGroup]="lowsalesForm">
					<div class="" fxLayout="row" fxLayoutGap="1%" fxLayoutAlign="left">
						<div fxFlex="50%">
							<mat-form-field fxFlex="100%" class="range-date-input">
								<mat-select [formControl]="lowsalesForm.controls['store_id']" placeholder="Store" [disableOptionCentering]="true">
									<mat-option *ngFor="let wh of storeList" [value]="wh.store_id">{{ wh.name }} </mat-option>
								</mat-select>
							</mat-form-field>
						</div>
						<div fxFlex="50%">
							<mat-form-field fxFlex="100%" class="range-date-input">
								<mat-select [formControl]="lowsalesForm.controls['product_type']" placeholder="Product Type" [disableOptionCentering]="true">
									<mat-option *ngFor="let item of productTypeList" [value]="item.product_type_slug">{{ item.product_name }} </mat-option>
								</mat-select>
							</mat-form-field>
						</div>
					</div>
				</form>
			</div>
		</mat-card>

		<mat-card class="box-shadow report-listing" *ngIf="this.rows.length > 0">
			<ngx-datatable
				#myDatatable
				class="material custom-table"
				[ngStyle]="{ height: dynamicHeight }"
				[headerHeight]="50"
				[limit]="10"
				[columnMode]="'force'"
				[footerHeight]="50"
				[rowHeight]="48"
				[scrollbarV]="true"
				[scrollbarH]="true"
				[rows]="rows"
			>
			<ngx-datatable-column [resizeable]="false" prop="variant_sku" name="Sku" [minWidth]="100">
				<ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
					<span title="{{ value }}"> {{ value }}</span>
				</ng-template>
			</ngx-datatable-column>
			<ngx-datatable-column [resizeable]="false" prop="product_name"   name="Product Name " [minWidth]="200">
				<ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
					<span title="{{ value }}"> {{ value }}</span>
				</ng-template>
			</ngx-datatable-column>

			<ngx-datatable-column [resizeable]="false" prop="last_selling_date" name="Date Last Sold" [minWidth]="220">
				<ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
					<span title="{{ value }}"> {{ value }}</span>
				</ng-template>
			</ngx-datatable-column>

			<ngx-datatable-column [resizeable]="false" prop="last_sold_day" name="# of Days Since Sold" [minWidth]="220">
				<ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
					<span title="{{ value }}"> {{ value }}</span>
				</ng-template>
			</ngx-datatable-column>

			<ngx-datatable-column [resizeable]="false" prop="on_hand_qty" name="# of Units on Hand" [minWidth]="150">
				<ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
					<span title="{{ value }}"> {{ value }}</span>
				</ng-template>
			</ngx-datatable-column>

			<ngx-datatable-column [resizeable]="false" prop="purchase_price" name="Purchase Price" [minWidth]="150">
				<ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
					<span title="{{ value }}"> {{ value }}</span>
				</ng-template>
			</ngx-datatable-column>

			<ngx-datatable-column [resizeable]="false" prop="selling_price" name="Current Selling Price" [minWidth]="120">
				<ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
					<span title="{{ value }}"> {{ value }}</span>
				</ng-template>
			</ngx-datatable-column>

			<ngx-datatable-column [resizeable]="false" prop="margin" name="Margin $" [minWidth]="120">
				<ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
					<span title="{{ value }}"> {{ value }}</span>
				</ng-template>
			</ngx-datatable-column>

			<ngx-datatable-column [resizeable]="false" prop="margin_percentage" name="Margin %" [minWidth]="120">
				<ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
					<span title="{{ value }}"> {{ value }}</span>
				</ng-template>
			</ngx-datatable-column>


				<ngx-datatable-footer>
					<ng-template ngx-datatable-footer-template let-rowCount="rows.length">
						<div class="total-rows">Total : {{ rows.length }}</div>
					</ng-template>
				</ngx-datatable-footer>
			</ngx-datatable>
		</mat-card>
		<div fxLayout="column" *ngIf="this.rows.length == 0 && !inProgress" class="report-error-msg">
			<div class="center">
				<div>
					<img src="../../assets/images/sad.svg" class="sad" alt="No Data Found" />
				</div>
				<div>
					<span class="Sorry-no-results-fo">Sorry, no results found</span>
				</div>
			</div>
		</div>
	</div>
</div>
