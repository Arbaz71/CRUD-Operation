<mat-card class="header-main-content">
    <div fxLayout="row">
        <div fxFlex="25%" fxFlex.md="40%" fxFlex.sm="40%" fxFlex.lg="30%" class="breadcrumb-content">
        </div>
        <div fxFlex="50%" fxFlex.md="20%" fxFlex.sm="20%" fxFlex.lg="40%" class="breadcrumb-header-content center">
            Refund Report
        </div>

        <div fxFlex="25%" fxFlex.md="40%" fxFlex.sm="40%" fxFlex.lg="30%" class="breadcrumb-btn-content end">
            <button mat-button matSuffix mat-stroked-button class="add-new-btn" [matMenuTriggerFor]="menu" type="button">
              <mat-icon class="report-header-button">get_app</mat-icon>
            
                <a class="add-new-label">EXPORT</a>
             
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item [disabled]="rows.length == 0" (click)="getExportPDF()">PDF</button>
              <button mat-menu-item [disabled]="rows.length == 0" (click)="getExportCSV('csv')">CSV</button>
              <button mat-menu-item [disabled]="rows.length == 0" (click)="getExportCSV('xls')">EXCEL</button>
            </mat-menu>
            <button mat-button matSuffix mat-stroked-button class="add-new-btn" (click)="reset_form()">
              <mat-icon class="report-header-button">refresh</mat-icon>
              <span>
                <a class="add-new-label">RESET</a>
              </span>
            </button>
          </div>
    </div>
</mat-card>


<mat-progress-bar mode="indeterminate" *ngIf="inProgress"></mat-progress-bar>

<div class="top-20 incidentreport-inner-height">
    <div  fxFlex="96%" fxFlexOffset="1%">

        <div fxLayout="column">
            <div class="searchbar-div" fxLayout="row" fxLayoutWrap fxLayoutAlign="center">
              <div class="customsales-search-input" fxFlex="100%" fxFlex.md="100%" fxFlex.lg="100%" fxFlex.sm="100%"
                fxFlex.xs="100%">
                <img class="Search-icon" src="../../assets/icon/search.png" alt="Search">
                <input class="Search" (keyup)="applyFilter($event.target.value)" placeholder="Search...">
                <span class="result-count">{{rows.length}} Results</span>
              </div>
            </div>

      <mat-card class="box-shadow report-filter-bar">
        <div _ngcontent-c41="" class="button-row">
          <form [formGroup]="refundFilterForm">
            <div fxLayout="row" class="" fxLayoutGap="1%">

              <div class="" fxFlex="50%">
                <mat-form-field fxFlex="100%">
                  <mat-select [formControl]="refundFilterForm.controls['store_id']" placeholder="Store" [disableOptionCentering]="true">
                      <mat-option  *ngFor="let store of stores" [value]="store.store_id">{{ store.name }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
             
              <div  fxFlex="50%">
                <mat-form-field fxFlex="100%" class="range-date-input">
                  <input type="text" autocomplete="off" readonly="true" matInput [locale]="localconfi"
                    [alwaysShowCalendars]="true" ngxDaterangepickerMd [(ngModel)]="selected" [isInvalidDate]="isInvalidDate" startKey="start" endKey="end" [ranges]="ranges"
                    [formControl]="refundFilterForm.controls['selected']" [minDate]="minDate" [maxDate]="maxDate" [autoApply]="true" placeholder="Select Dates" [opens]="'left'">
                </mat-form-field>
              </div>
            </div>
          </form>
        </div>
      </mat-card>


  
      <mat-card class="box-shadow report-listing" *ngIf="rows.length > 0" style="overflow: auto;">
        <ngx-datatable #myDatatable class="material fancyscroll refund-report-table" [ngStyle]="{'height':dynamicHeight}"
          [headerHeight]="50" [limit]="10" [columnMode]="'force'" [footerHeight]="50" [rowHeight]="48" [scrollbarV]="true"
          [rows]="rows" [scrollbarH]="true">
          <ngx-datatable-column [resizeable]="false" prop="order_id" name="Order ID" [width]="100">
            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
              <span title="{{value}}"> {{value}}</span>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column [resizeable]="false" prop="purchase_price" name="Purchase Price " [width]="135">
            <ng-template  ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
              <span  title="{{value}}"> ${{value}}</span>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column [resizeable]="false" prop="purchase_price_lot" name="Purchase Price Lot" [width]="150">
            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
              <span title="{{value}}"> ${{value}}</span>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column [resizeable]="false" prop="batch_no" name="Batch" [width]="110">
            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
              <span title="{{value}}"> {{value ? value : 'None'}}</span>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column [resizeable]="false" prop="variant_sku" name="SKU" [width]="135">
            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
              <span title="{{value}}"> {{value}}</span>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column [resizeable]="false" prop="product_name" name="Product Name" [width]="230">
            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
              <span title="{{value}}"> {{value}}</span>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column [resizeable]="false" prop="variant_name" name="Variant Name" [width]="230">
            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
              <span title="{{value}}"> {{value}}</span>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column [resizeable]="false" prop="order_placed" name="Date Sold" [width]="110">
            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
              <span title="{{value}}"> {{value | date: 'dd/MM/yyyy hh:mm a'}}</span>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column [resizeable]="false" prop="remark" name="Reason" [width]="110">
            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
              <span title="{{value}}"> {{value ? value : 'None'}}</span>
            </ng-template>
          </ngx-datatable-column>
  
          <ngx-datatable-footer>
              <ng-template 
                  ngx-datatable-footer-template 
                  let-rowCount="rowCount">
                  <div class="total-rows">
                      Total : {{rowCount}}
                  </div>
              </ng-template>
          </ngx-datatable-footer>
        </ngx-datatable>
      </mat-card>
      <div fxLayout="column" *ngIf="rows.length==0 && !inProgress" class="report-error-msg">
        <div class="center">
          <div>
            <img src="../../assets/images/sad.svg" class="sad" alt="No Data Found">
          </div>
          <div>
            <span class="Sorry-no-results-fo">Sorry, no results found</span>
          </div>
        </div>
      </div>
    </div>
  </div>
