<mat-card class="header-main-content">
    <div fxLayout="row">
        <div fxFlex="25%" class="breadcrumb-content">
        </div>
        <div fxFlex="50%" class="breadcrumb-header-content">
            Stores
        </div>
        <div fxFlex="25%" class="breadcrumb-btn-content">
            <button class="add-new-btn" [routerLink]="['create']" type="button">
                <a class="add-new-label">
                    <img src="assets/icon/plus-math.svg" alt="Add New" class="plus-math">
                    ADD NEW</a>
            </button>
        </div>
    </div>
</mat-card> 
<mat-progress-bar mode="indeterminate" *ngIf="inProgress"></mat-progress-bar>
<div style="padding-top: 20px">
    <div  fxFlex="96%" fxFlexOffset="2%">
        <div fxLayout="column" fxLayoutGap="20px">
            <div class="" fxLayout="row" fxLayoutWrap fxLayoutAlign="center">
                <div class="store-search-input" fxFlex="100%">
                    <img alt="Search" class="Search-icon" src="../../assets/icon/search.png">
                    <input class="Search" (keyup)="applyFilter($event.target.value)" placeholder="Search store name...">
                    <span class="result-count">{{rows.length}} Results</span>
                </div>
            </div>
        </div> 
        <div fxLayout="column" class="main-container" *ngIf="rows.length > 0">
            <mat-card class="list-bulk-action-header">
                <div _ngcontent-c41="" class="button-row add-tag-button">
                    <span matTooltip="Select one or more stores to add Tags." [matTooltipDisabled]="selected.length>0">
                    <button mat-button mat-stroked-button [disabled]="selected.length<1"
                        class="mat-add-tag-btn" type="button" (click)="AddNewTag('ALL')">
                        ADD TAGS
                    </button>
                    </span>
                </div>
            </mat-card>
            <div class="store-list-content">
                <ngx-datatable #myTable class='material expandable fancyscroll store-list-table'
                    [headerHeight]="50" [externalPaging]="false" [footerHeight]="0" 
                    [columnMode]="'flex'" [rowHeight]="48" [scrollbarV]="true" [rows]='rows' [limit]="5"
                    [selected]="selected" [selectionType]="'checkbox'" (activate)="onActivate($event)"
                    (select)='onSelect($event)'>
                    <!-- Row Detail Template -->
                    <ngx-datatable-row-detail [rowHeight]="155" #myDetailRow style="cursor: auto;">
                        <ng-template let-row="row" let-expanded="expanded" ngx-datatable-row-detail-template>
                            <div class="example-element-detail" fxLayoutGap="4px">
                                <div fxFlex="48%" fxFlexOffset="63px" class="tags fancyscroll">
                                    <div>
                                        <p style="white-space: pre-wrap;"><strong>Manager:</strong>
                                            {{row['manager_name']}}</p>
                                        <p><strong>Address:</strong>{{row['store_location']}}</p>
                                        <p><strong>Email:</strong> {{row['contact_email']}}</p>
                                        <p><strong>Phone:</strong> {{row['contact_no']}}</p>
                                        <p><strong>Store ID:</strong> {{row['store_id']}}</p>
                                    </div>
                                </div>
                                <div fxFlex="48%" class="tags fancyscroll">
                                    <div fxLayout="row wrap">
                                    <div class="tag-div"  *ngFor="let item of row['tags']"> 
                                        <div class="tag-text" >{{item.tag_name}}</div>
                                    </div>
                                    </div>
                                    <mat-chip-list>
                                        <button type="button" class="ADD-TAG pointer" (click)="AddNewTag(row)">
                                            <img src="assets/icon/plus-math.svg" alt="Add New" class="plus-math add-tag-icon">
                                            ADD TAG
                                        </button>
                                    </mat-chip-list>
                                </div>
                            </div>
                        </ng-template>
                    </ngx-datatable-row-detail>
                    <ngx-datatable-column name="" [sortable]="false" [draggable]="false" [resizeable]="false"
                        [flexGrow]="1"  [maxWidth]="70" [minWidth]="50">
                        <ng-template ngx-datatable-header-template let-allRowsSelected="allRowsSelected"
                        let-selectFn="selectFn">
                            <div style="width: 30px !important;">
                                <mat-checkbox color="primary" class="all-select-checkbox"
                                (change)="selectFn(!allRowsSelected)" [checked]="allRowsSelected"
                                [indeterminate]="!allRowsSelected && selected.length>0">
                                </mat-checkbox>
                            </div>
                        </ng-template>
                        <ng-template ngx-datatable-cell-template let-row="row" let-expanded="expanded" let-value="value"
                        let-isSelected="isSelected" let-onCheckboxChangeFn="onCheckboxChangeFn">
                            <div class="checkbox-column" style="width: 30px !important;">
                                <a href="javascript:void(0)" [class.datatable-icon-right]="!expanded"
                                    [class.datatable-icon-down]="expanded" title="Expand/Collapse Row"
                                    class="ngx-expand-arrow"></a>
                                <mat-checkbox color="primary" (click)="$event.stopPropagation();"
                                (change)="onCheckboxChangeFn($event);" [checked]="isSelected">
                                </mat-checkbox>
                            </div>
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Store Name" prop="name" [resizeable]="false" [flexGrow]="3" >
                        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                            {{row['name']}}
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="City" prop="city.location_name" [resizeable]="false" [flexGrow]="3" >
                        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                            {{row['city'].location_name}}
                        </ng-template>
                    </ngx-datatable-column>

                    <ngx-datatable-column name="# of Employees" prop="total_staff" [resizeable]="false" 
                        [flexGrow]="3"  >
                        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                            {{row['total_staff']+row['total_manager']}}/{{row['active_manager']+row['active_staff']}}
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Today's Sales" prop="today_sales" [resizeable]="false" [flexGrow]="3"
                          >
                        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                            {{row['today_sales']|currency}}
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Date Created" prop="store_added_on"  [resizeable]="false" [flexGrow]="3" >
                        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                            {{utils.convertLocalDateToUTCDate(row['store_added_on'],false)|date}}
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="View" [sortable]="false" [resizeable]="false"  [flexGrow]="1" >
                        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                            <button mat-icon-button [routerLink]="['/stores', row['store_id'], 'view']">
                                <mat-icon>visibility</mat-icon>
                            </button>
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-footer>
                        <ng-template ngx-datatable-footer-template></ng-template>
                    </ngx-datatable-footer>
                </ngx-datatable>
            </div>
        </div>
        <div fxLayout="column" *ngIf="rows.length==0 && !inProgress" style="margin-top: 60px;">
            <div class="center">
                <div>
                    <img alt="No results found" src="../../assets/images/sad.svg" class="sad">
                </div>
                <div>
                    <span class="Sorry-no-results-fo">Sorry, no results found</span>
                </div>
                <div *ngIf="(!Users ||Users.length > 0) && !inProgress">
                    <span class="Please-try-a-differe">Please try a different keyword</span>
                </div>
            </div>
        </div>
    </div>
    <div class="row-selecetd-count" *ngIf="selected.length>0">
        <span>{{selected.length}} Rows Selected</span>
    </div>
</div>